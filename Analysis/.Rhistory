# fixed effects to avoid collinearity
FE_vars_dd <- c("aisp",
"month_semester",
"year",
"id_cmt")
# Set cluster SE level
cluster_vars_dd= "0"
if(RUN_main_analysis){
source(file.path(HOME_DIR, "02-analysis-main.R"))
}
if(RUN_main_analysis){
source(file.path(HOME_DIR, "Analysis/02-analysis-main.R"))
}
OUTPUTS_final
OUTPUTS_final
OUTPUTS
#------------------------------------------------------------------------------#
#	 SIM- Master script
#------------------------------------------------------------------------------#
rm(list = ls())
#------------------------------------------------------------------------------#
#### Section switches ####
# Run differnt sections of analysis
RUN_var_construction = T
# Main analysis
RUN_main_analysis = T
RUN_desc_analysis = T
# Robustness checks
RUN_placebo_analysis = T
RUN_poisson_analysis = T
RUN_spatial_analysis = T
# Settings switches
EXPORT_data = T
EXPORT_plots = F
EXPORT_tables = T
#------------------------------------------------------------------------------#
#### Packages ####
library(tidyverse)
library(magrittr)
library(readstata13)
library(lfe)
# library(shomR) # ConleySEs but not on CRAN
library(spdep) # lagsarlm
library(plm) # Panel data
library(splm) # Spatial panel data
library(Rcpp)
library(Hmisc)
library(stargazer)
library(huxtable)
library(flextable)
#library(officer)
#library(ReporteRs)
library(jtools)
library(rgeos)
library(rgdal)
library(sp)
library(maps)
library(geosphere)
library(viridis)
library(tmap)
library(spdep) # Moran's I
library(spatialreg) # Spatial lag model
library(readstata13)
library(tidyverse)
library(broom)
library(data.table)
#------------------------------------------------------------------------------#
#### Projections ####
RjProj_aze <- CRS("+proj=aeqd +lat_0=-22.911522 +lon_0=-43.397503")
RjProj_unp <- CRS("+init=epsg:4326")
#------------------------------------------------------------------------------#
#### File paths ####
HOME_DIR <- "D:/RA Joana/Sistema de Metas/ReplicationFiles/"
CONLEYse_FUNs <- file.path(HOME_DIR, "ConleySE")
DATA <- file.path(HOME_DIR, "data")
OUTPUTS <- file.path(HOME_DIR, "Output")
# OUTPUTS_final <- file.path(OUTPUTS, "Final")
OUTPUTS_final <- OUTPUTS
GIS <- file.path(HOME_DIR, "DATA/GIS")
#------------------------------------------------------------------------------#
#### Function definition ####
source(file.path(HOME_DIR, "Analysis/utils.R"))
#------------------------------------------------------------------------------#
#### Database creation ####
# if(RUN_var_construction){
#   source(file.path(HOME_DIR, "00-creation.R"))
# }
#------------------------------------------------------------------------------#
#### Load Data ####
# Load raw data to construct placebo targets
# raw_data <- read.dta13(file.path(DATA,"data_SIM_2021-07.dta"))
#------------------------------------------------------------------------------#
#### Create placebo targets ####
if(RUN_var_construction){
source(file.path(HOME_DIR, "Analysis/01-construction.R"))
}
# Load final data created
if(file.exists(file.path(DATA, "data_SIM_2019_constructed_extra.csv"))){
final_data <- fread(file = file.path(DATA, "data_SIM_2019_constructed_extra.csv"),
encoding = "UTF-8", dec = ',')
}else{
print("Please, turn RUN_placebo_targets_construction to TRUE and run again.")
}
#------------------------------------------------------------------------------#
#### Globals ####
####  List regression variables
depVars <- c("violent_death_sim",
"vehicle_robbery",
"street_robbery",
"homicide",
"dpolice_killing",
"police_killing",
"vehicle_theft",
"street_theft",
"dbody_found",
"other_robberies",
"cargo_robbery",
'body_bones_found',
'other_robberies',
'attempt_homicide',
'involuntary_homicide',
'other_homicides',
'theft',
'all_violent_deaths')
# Temporario
depVars <- c(depVars,paste0(depVars,'_log'))
names(depVars) <- depVars
indepVars <- c(
# "hit_month_l",
"hit_sem_l",
# "policemen_aisp",
# "policemen_upp",
"n_precinct",
"max_prize",
"population" )
names(indepVars) <- indepVars
FEVars <- c("aisp",
"month_semester",
'year',
"id_cmt")
names(FEVars) <- FEVars
ZVars <- c("lag12_dist_target_vr",
"lag12_dist_target_sr",
"lag12_dist_target_vd")
names(ZVars) <- ZVars
#-----------------------------#
# Diff in Diff (a.k.a Virada) #
indep_vars_dd <- c(
"hit_sem_fm_l",
"month6",
"last_month",
"n_precinct",
"max_prize",
"population" )
# Since there are only 4 months in this analysis I'm removing month
# fixed effects to avoid collinearity
FE_vars_dd <- c("aisp",
"month_semester",
"year",
"id_cmt")
# Set cluster SE level
cluster_vars_dd= "0"
#------------------------------------------------------------------------------#
#### Sections ####
#------------------------------------------------------------------------------#
#### Main Analysis ####
if(RUN_main_analysis){
source(file.path(HOME_DIR, "Analysis/02-analysis-main.R"))
}
if(RUN_desc_analysis){
source(file.path(HOME_DIR, "Analysis/02-analysis-descriptives.R"))
}
if(RUN_poisson_analysis){
source(file.path(HOME_DIR, "Analysis/03-robustness-poisson.R"))
}
if(RUN_spatial_analysis){
source(file.path(HOME_DIR, "Analysis/03-robustness-spatial2.R"))
}
if(RUN_placebo_analysis){
source(file.path(HOME_DIR, "Analysis/03-robustness-placebo.R"))
}
DATA
source("D:/RA Joana/Sistema de Metas/pmrj - Mathias/MASTER.R", echo=TRUE)
source("D:/RA Joana/Sistema de Metas/pmrj - Mathias/MASTER.R", echo=TRUE)
source("D:/RA Joana/Sistema de Metas/pmrj - Mathias/MASTER.R", echo=TRUE)
sim
View(sim)
source("D:/RA Joana/Sistema de Metas/pmrj - Mathias/MASTER.R", echo=TRUE)
source("D:/RA Joana/Sistema de Metas/pmrj - Mathias/MASTER.R", echo=TRUE)
source("D:/RA Joana/Sistema de Metas/pmrj - Mathias/MASTER.R", echo=TRUE)
source("D:/RA Joana/Sistema de Metas/pmrj - Mathias/MASTER.R", echo=TRUE)
# Keep same sample for as regressions
sd <- feRegSim('violent_death_sim') %>% regData(regdf = sr)
sd
sd$pop1000 <- sd$population/1000
# Select variables
tab1Vars <- c("hit_sem_l",
depVars[1:3],
'homicide',
'police_killing',
'dpolice_killing',
'body_bones_found',
'attempt_homicide',
'other_robberies',
'vehicle_theft',
'street_theft',
"max_prize",
"pop1000",
'n_precinct')
tab1VarLabels <- c("Eligible",
"Violent deaths",
"Vehicle robbery",
"Street robbery",
"Homicides",
"Police killing",
"Police killing (dummy)",
"Cadavers and Bones Found",
"Attempted Murders",
"Other robberies not included in the target",
"Vehicle theft",
"Street theft",
"Maximum prize (R$ 1000)",
"District population (1000 hab)",
"Number of precint")
stargazer(sd %>% dplyr::select(tab1Vars),
summary.stat = c("n", "mean", "sd", "min", "max"),
type = "text",
out = file.path(OUTPUTS_final, "tab1.html"),
covariate.labels = tab1VarLabels
)
# Keep same sample for as regressions
sd <- feRegSim('violent_death_sim') %>% regData(regdf = final_data)
sd$pop1000 <- sd$population/1000
# Select variables
tab1Vars <- c("hit_sem_l",
depVars[1:3],
'homicide',
'police_killing',
'dpolice_killing',
'body_bones_found',
'attempt_homicide',
'other_robberies',
'vehicle_theft',
'street_theft',
"max_prize",
"pop1000",
'n_precinct')
tab1VarLabels <- c("Eligible",
"Violent deaths",
"Vehicle robbery",
"Street robbery",
"Homicides",
"Police killing",
"Police killing (dummy)",
"Cadavers and Bones Found",
"Attempted Murders",
"Other robberies not included in the target",
"Vehicle theft",
"Street theft",
"Maximum prize (R$ 1000)",
"District population (1000 hab)",
"Number of precint")
stargazer(sd %>% dplyr::select(tab1Vars),
summary.stat = c("n", "mean", "sd", "min", "max"),
type = "text",
out = file.path(OUTPUTS_final, "tab1.html"),
covariate.labels = tab1VarLabels
)
RUN_main_analysis
source(file.path(GITHUB, "02-analysis-main.R"))
#------------------------------------------------------------------------------#
#	 SIM- Master script
#------------------------------------------------------------------------------#
rm(list = ls())
#------------------------------------------------------------------------------#
#### Section switches ####
# Run differnt sections of analysis
RUN_var_construction = T
# Main analysis
RUN_main_analysis = T
RUN_desc_analysis = T
# Robustness checks
RUN_placebo_analysis = T
RUN_poisson_analysis = T
RUN_spatial_analysis = T
# Settings switches
EXPORT_data = T
EXPORT_plots = F
EXPORT_tables = T
#------------------------------------------------------------------------------#
#### Packages ####
library(tidyverse)
library(magrittr)
library(readstata13)
library(lfe)
# library(shomR) # ConleySEs but not on CRAN
library(spdep) # lagsarlm
library(plm) # Panel data
library(splm) # Spatial panel data
library(Rcpp)
library(Hmisc)
library(stargazer)
library(huxtable)
library(flextable)
#library(officer)
#library(ReporteRs)
library(jtools)
library(rgeos)
library(rgdal)
library(sp)
library(maps)
library(geosphere)
library(viridis)
library(tmap)
library(spdep) # Moran's I
library(spatialreg) # Spatial lag model
library(readstata13)
library(tidyverse)
library(broom)
library(data.table)
#------------------------------------------------------------------------------#
#### Projections ####
RjProj_aze <- CRS("+proj=aeqd +lat_0=-22.911522 +lon_0=-43.397503")
RjProj_unp <- CRS("+init=epsg:4326")
#------------------------------------------------------------------------------#
#### File paths ####
HOME_DIR <- "D:/RA Joana/Sistema de Metas/ReplicationFiles/"
CONLEYse_FUNs <- file.path(HOME_DIR, "ConleySE")
DATA <- file.path(HOME_DIR, "data")
OUTPUTS <- file.path(HOME_DIR, "Output")
# OUTPUTS_final <- file.path(OUTPUTS, "Final")
OUTPUTS_final <- OUTPUTS
GIS <- file.path(HOME_DIR, "DATA/GIS")
#------------------------------------------------------------------------------#
#### Function definition ####
source(file.path(HOME_DIR, "Analysis/utils.R"))
#------------------------------------------------------------------------------#
#### Load Data ####
#### Create placebo targets ####
if(RUN_var_construction){
source(file.path(HOME_DIR, "Analysis/01-construction.R"))
}
# Load final data created
if(file.exists(file.path(DATA, "data_SIM_2019_constructed_extra.csv"))){
final_data <- fread(file = file.path(DATA, "data_SIM_2019_constructed_extra.csv"),
encoding = "UTF-8", dec = ',')
}else{
print("Please, turn RUN_placebo_targets_construction to TRUE and run again.")
}
#------------------------------------------------------------------------------#
#### Globals ####
####  List regression variables
depVars <- c("violent_death_sim",
"vehicle_robbery",
"street_robbery",
"homicide",
"dpolice_killing",
"police_killing",
"vehicle_theft",
"street_theft",
"dbody_found",
"other_robberies",
"cargo_robbery",
'body_bones_found',
'other_robberies',
'attempt_homicide',
'involuntary_homicide',
'other_homicides',
'theft',
'all_violent_deaths')
# Temporario
depVars <- c(depVars,paste0(depVars,'_log'))
names(depVars) <- depVars
indepVars <- c(
"hit_sem_l",
"n_precinct",
"max_prize",
"population" )
names(indepVars) <- indepVars
FEVars <- c("aisp",
"month_semester",
'year',
"id_cmt")
names(FEVars) <- FEVars
#-----------------------------#
# Diff in Diff (a.k.a Virada) #
indep_vars_dd <- c(
"hit_sem_fm_l",
"month6",
"last_month",
"n_precinct",
"max_prize",
"population" )
# Since there are only 4 months in this analysis I'm removing month
# fixed effects to avoid collinearity
FE_vars_dd <- c("aisp",
"month_semester",
"year",
"id_cmt")
# Set cluster SE level
cluster_vars_dd= "0"
#------------------------------------------------------------------------------#
#### Sections ####
#------------------------------------------------------------------------------#
#### Main Analysis ####
if(RUN_desc_analysis){
source(file.path(HOME_DIR, "Analysis/02-analysis-descriptives.R"))
}
#------------------------------------------------------------------------------#
#### Load data ####
rFormula <- paste(indepVars, collapse = " + ")
FeForumala1 <- paste(FEVars[1:2], collapse = " + ")
config1 <- paste("|", FeForumala1, "| 0 | ", clusterVars_form )
Formulas01_str <- paste(depVars, paste(rFormula, config1), sep = " ~ ")
#------------------------------------------------------------------------------#
#### Load data ####
rFormula <- paste(indepVars, collapse = " + ")
FeForumala1 <- paste(FEVars[1:2], collapse = " + ")
clusterVars_form <- paste(clusterVars, collapse =  " + ")
config1 <- paste("|", FeForumala1, "| 0 | ", clusterVars_form )
#------------------------------------------------------------------------------#
#### Load data ####
rFormula <- paste(indepVars, collapse = " + ")
FeForumala1 <- paste(FEVars[1:2], collapse = " + ")
clusterVars = c("aisp" )
clusterVars_form <- paste(clusterVars, collapse =  " + ")
config1 <- paste("|", FeForumala1, "| 0 | ", clusterVars_form )
Formulas01_str <- paste(depVars, paste(rFormula, config1), sep = " ~ ")
# Keep same sample for as regressions
sd <- feRegSim('violent_death_sim') %>% regData(regdf = final_data)
feRegSim('violent_death_sim') %>% regData(regdf = final_data)
Formulas01_str
#------------------------------------------------------------------------------#
#### Load data ####
rFormula <- paste(indepVars, collapse = " + ")
FeForumala1 <- paste(FEVars[1:2], collapse = " + ")
clusterVars = c("aisp" )
clusterVars_form <- paste(clusterVars, collapse =  " + ")
config1 <- paste("|", FeForumala1, "| 0 | ", clusterVars_form )
Formulas01_str <- paste(depVars, paste(rFormula, config1), sep = " ~ ")
names(Formulas00_str) <- depVars
names(Formulas01_str) <- depVars
# Keep same sample for as regressions
sd <- feRegSim('violent_death_sim') %>% regData(regdf = final_data)
# Keep same sample for as regressions
sd <- feRegSim('violent_death_sim') %>% regData(regdf = sr)
#------------------------------------------------------------------------------#
#### Load data ####
sr <- final_data %>%
# Removing lower and upper bounds we don't have data on batallion sizes after
# 2015 and the system begun in the second semmester of 2009
subset((year*10 + semester > 20091))
rFormula <- paste(indepVars, collapse = " + ")
FeForumala1 <- paste(FEVars[1:2], collapse = " + ")
clusterVars = c("aisp" )
clusterVars_form <- paste(clusterVars, collapse =  " + ")
config1 <- paste("|", FeForumala1, "| 0 | ", clusterVars_form )
Formulas01_str <- paste(depVars, paste(rFormula, config1), sep = " ~ ")
names(Formulas01_str) <- depVars
# Keep same sample for as regressions
sd <- feRegSim('violent_death_sim') %>% regData(regdf = sr)
sr <- final_data %>%
# Removing lower and upper bounds we don't have data on batallion sizes after
# 2015 and the system begun in the second semmester of 2009
subset((year*10 + semester > 20091))
placebo_data <- final_data %>%
# Removing lower and upper bounds we don't have data on batallion sizes after
# 2015 and the system begun in the second semmester of 2009
subset((year*10 + semester < 20091))
# Diff in diff
# Create a data set with only target months
dd_df <- sr %>%
# Keep only regression months
subset(month %in% c(6,7,12,1))
# right hand side without FE
rFormula <- paste(indepVars, collapse = " + ")
# clusterVars = c("latitude", "longitude" )
clusterVars = c("aisp" )
clusterVars_form <- paste(clusterVars, collapse =  " + ")
config0 <- paste("|", 0, "| 0 | ", clusterVars_form )
FeForumala1 <- paste(FEVars[1:2], collapse = " + ")
config1 <- paste("|", FeForumala1, "| 0 | ", clusterVars_form )
FeForumala2 <- paste(FEVars, collapse = " + ") # with cmd FE
config2 <- paste("|", FeForumala2, "| 0 |  ", clusterVars_form)
Formulas00_str <- paste(depVars, paste('hit_sem_l', config0), sep = " ~ ")
Formulas01_str <- paste(depVars, paste(rFormula, config1), sep = " ~ ")
Formulas02_str <- paste(depVars, paste(rFormula, config2), sep = " ~ ")
# So it's easier to reference to elements
names(Formulas00_str) <- depVars
names(Formulas01_str) <- depVars
names(Formulas02_str) <- depVars
#### Construct monthly regression formulas
month_dummies <- c("month2",
"month3",
"month4",
"month5",
"month6")
rFormula00_plot <- paste(c('hit_sem_l',
month_dummies),
collapse = " + ")
rFormula_plot <- paste(c('hit_sem_l',
month_dummies,
# Remove on_targer as it is already in the interactions
indepVars[-1]),
collapse = " + ")
# Montlhy formulas
Formulas00_plot_str <- paste(depVars, paste(rFormula00_plot, '|month'), sep = " ~ ")
names(Formulas00_plot_str) <- depVars
Formulas02_plot_str <- paste(depVars, paste(rFormula_plot, config2), sep = " ~ ")
source("D:/RA Joana/Sistema de Metas/pmrj - Mathias/MASTER.R", echo=TRUE)
source("D:/RA Joana/Sistema de Metas/pmrj - Mathias/MASTER.R", echo=TRUE)
source("D:/RA Joana/Sistema de Metas/pmrj - Mathias/MASTER.R", echo=TRUE)
